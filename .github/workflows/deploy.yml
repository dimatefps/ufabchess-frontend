name: Deploy UFABCHESS

on:
  push:
    branches: ["main"]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Injetar Variáveis no env.js
        run: |
          # O sed substitui as etiquetas pelos segredos que você salvou no GitHub
          sed -i "s|{{SUPABASE_URL}}|${{ secrets.SUPABASE_URL }}|g" docs/scripts/services/env.js
          sed -i "s|{{SUPABASE_ANON_KEY}}|${{ secrets.SUPABASE_ANON_KEY }}|g" docs/scripts/services/env.js
          
          # Verificação simples no log do Action (sem mostrar as chaves reais)
          echo "Arquivo env.js processado."
          ls -l docs/scripts/services/env.js

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./docs # Envia a pasta docs já processada para o deploy

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4